import Phaser from"phaser";import Player from"../Entities/Player";import GunShip from"../Entities/GunShip";import ChaserShip from"../Entities/ChaserShip";import CarrierShip from"../Entities/CarrierShip";import ScrollingBackground from"../Entities/Scrolling";export default class SceneMain extends Phaser.Scene{constructor(){super({key:"SceneMain"})}preload(){this.load.image("sprBg0","assets/img/sprBg0.png"),this.load.image("sprBg0","assets/img/sprBg0.png"),this.load.image("sprBg1","assets/img/sprBg1.png"),this.load.spritesheet("sprExplosion","assets/img/bubble_explo4.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("sprEnemy0","assets/img/enemy-small.png",{frameWidth:16,frameHeight:16}),this.load.image("sprEnemy1","assets/img/sprEnemy1.png"),this.load.spritesheet("sprEnemy2","assets/img/white.png",{frameWidth:31,frameHeight:31}),this.load.image("sprLaserEnemy0","assets/img/sprLaserEnemy0.png"),this.load.spritesheet("sprLaserPlayer","assets/img/laser-bolts.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("sprPlayer","assets/img/ship.png",{frameWidth:16,frameHeight:32}),this.load.audio("sndExplode0","assets/audio/explosion03.wav"),this.load.audio("sndExplode1","assets/audio/sndExplode1.wav"),this.load.audio("sndLaser","assets/audio/sndLaser.wav")}create(){window.global.music.stop(),window.global.score=0,window.global.scoreText=this.add.text(16,16,`Score: ${window.global.score}`,{fontSize:"24px",fill:"#fff"}),this.anims.create({key:"sprEnemy0",frames:this.anims.generateFrameNumbers("sprEnemy0"),frameRate:20,repeat:-1}),this.anims.create({key:"sprEnemy2",frames:this.anims.generateFrameNumbers("sprEnemy2"),frameRate:20,repeat:-1}),this.anims.create({key:"sprExplosion",frames:this.anims.generateFrameNumbers("sprExplosion"),frameRate:20,repeat:0}),this.anims.create({key:"sprPlayer",frames:this.anims.generateFrameNumbers("sprPlayer"),frameRate:20,repeat:-1}),this.sfx={explosions:[this.sound.add("sndExplode0"),this.sound.add("sndExplode1")],laser:this.sound.add("sndLaser",{volume:.3})},this.backgrounds=[];for(let e=0;e<5;e+=1){const s=new ScrollingBackground(this,"sprBg0",10*e);this.backgrounds.push(s)}this.player=new Player(this,.5*this.game.config.width,.5*this.game.config.height,"sprPlayer"),this.keyUp=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP),this.keyDown=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN),this.keyLeft=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.keyRight=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.keySpace=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.enemies=this.add.group(),this.enemyLasers=this.add.group(),this.playerLasers=this.add.group(),this.time.addEvent({delay:1e3,callback:()=>{let e=null;Phaser.Math.Between(0,10)>=3?e=new GunShip(this,Phaser.Math.Between(0,this.game.config.width),0):Phaser.Math.Between(0,10)>=5?this.getEnemiesByType("ChaserShip").length<5&&(e=new ChaserShip(this,Phaser.Math.Between(0,this.game.config.width),0)):e=new CarrierShip(this,Phaser.Math.Between(0,this.game.config.width),0),null!==e&&(e.setScale(.1*Phaser.Math.Between(10,20)),this.enemies.add(e))},callbackScope:this,loop:!0}),this.physics.add.collider(this.playerLasers,this.enemies,((e,s)=>{s&&(void 0!==s.onDestroy&&s.onDestroy(),s.explode(!0),e.destroy(),window.global.score+=5,window.global.scoreText.setText(`Score: ${window.global.score}`))})),this.physics.add.overlap(this.player,this.enemies,((e,s)=>{e.getData("isDead")||s.getData("isDead")||(e.explode(!1),e.onDestroy(),s.explode(!0))})),this.physics.add.overlap(this.player,this.enemyLasers,((e,s)=>{e.getData("isDead")||s.getData("isDead")||(e.explode(!1),e.onDestroy(),s.destroy())}))}getEnemiesByType(e){const s=[];for(let t=0;t<this.enemies.getChildren().length;t+=1){const i=this.enemies.getChildren()[t];i.getData("type")===e&&s.push(i)}return s}update(){this.player.getData("isDead")||(this.player.update(),this.keyUp.isDown?this.player.moveUp():this.keyDown.isDown&&this.player.moveDown(),this.keyLeft.isDown?this.player.moveLeft():this.keyRight.isDown&&this.player.moveRight(),this.keySpace.isDown?this.player.setData("isShooting",!0):(this.player.setData("timerShootTick",this.player.getData("timerShootDelay")-1),this.player.setData("isShooting",!1)));for(let e=0;e<this.enemies.getChildren().length;e+=1){const s=this.enemies.getChildren()[e];s.update(),(s.x<-s.displayWidth||s.x>this.game.config.width+s.displayWidth||s.y<4*-s.displayHeight||s.y>this.game.config.height+s.displayHeight)&&s&&(void 0!==s.onDestroy&&s.onDestroy(),s.destroy())}for(let e=0;e<this.enemyLasers.getChildren().length;e+=1){const s=this.enemyLasers.getChildren()[e];s.update(),(s.x<-s.displayWidth||s.x>this.game.config.width+s.displayWidth||s.y<4*-s.displayHeight||s.y>this.game.config.height+s.displayHeight)&&s&&s.destroy()}for(let e=0;e<this.playerLasers.getChildren().length;e+=1){const s=this.playerLasers.getChildren()[e];s.update(),(s.x<-s.displayWidth||s.x>this.game.config.width+s.displayWidth||s.y<4*-s.displayHeight||s.y>this.game.config.height+s.displayHeight)&&s&&s.destroy()}for(let e=0;e<this.backgrounds.length;e+=1)this.backgrounds[e].update()}}